<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Accuracy Analysis | TPV Career Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --bg-elevated: #232d42;
            --border-color: #2d3a52;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;

            /* ARR Band Colors */
            --diamond: #22d3ee;
            --diamond-glow: rgba(34, 211, 238, 0.3);
            --platinum: #a1a1aa;
            --platinum-glow: rgba(161, 161, 170, 0.3);
            --gold: #fbbf24;
            --gold-glow: rgba(251, 191, 36, 0.3);
            --silver: #9ca3af;
            --silver-glow: rgba(156, 163, 175, 0.3);
            --bronze: #d97706;
            --bronze-glow: rgba(217, 119, 6, 0.3);

            /* Accent colors */
            --accent-positive: #10b981;
            --accent-negative: #ef4444;
            --accent-neutral: #6366f1;
            --accent-highlight: #f472b6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Grid background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(45, 58, 82, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(45, 58, 82, 0.15) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        .dashboard {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header h1::before {
            content: '';
            display: block;
            width: 4px;
            height: 28px;
            background: linear-gradient(180deg, var(--accent-highlight), var(--accent-neutral));
            border-radius: 2px;
        }

        .header-meta {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
            display: flex;
            gap: 1.5rem;
        }

        .header-meta span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-positive);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Key Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            border-color: var(--accent-neutral);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.15);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-neutral), var(--accent-highlight));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.1;
        }

        .metric-value.highlight {
            color: var(--accent-highlight);
        }

        .metric-value.positive {
            color: var(--accent-positive);
        }

        .metric-value.negative {
            color: var(--accent-negative);
        }

        .metric-subtext {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            margin-top: 2rem;
        }

        .section-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .section-header::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, var(--border-color), transparent);
        }

        /* Charts Container */
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 1024px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .chart-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .chart-container {
            position: relative;
            height: 280px;
        }

        .chart-container.tall {
            height: 350px;
        }

        /* ARR Band Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            color: var(--text-muted);
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th:first-child {
            border-radius: 8px 0 0 0;
        }

        .data-table th:last-child {
            border-radius: 0 8px 0 0;
        }

        .data-table td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid var(--border-color);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover td {
            background: var(--bg-elevated);
        }

        .band-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Outfit', sans-serif;
            font-weight: 500;
        }

        .band-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .band-dot.diamond { background: var(--diamond); box-shadow: 0 0 8px var(--diamond-glow); }
        .band-dot.platinum { background: var(--platinum); box-shadow: 0 0 8px var(--platinum-glow); }
        .band-dot.gold { background: var(--gold); box-shadow: 0 0 8px var(--gold-glow); }
        .band-dot.silver { background: var(--silver); box-shadow: 0 0 8px var(--silver-glow); }
        .band-dot.bronze { background: var(--bronze); box-shadow: 0 0 8px var(--bronze-glow); }

        .trend-positive {
            color: var(--accent-positive);
        }

        .trend-negative {
            color: var(--accent-negative);
        }

        .trend-neutral {
            color: var(--text-muted);
        }

        /* Comparison Cards */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        .comparison-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .comparison-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .comparison-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .comparison-icon.human {
            background: linear-gradient(135deg, var(--accent-highlight), #ec4899);
        }

        .comparison-icon.bot {
            background: linear-gradient(135deg, var(--accent-neutral), #8b5cf6);
        }

        .comparison-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .comparison-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .comparison-stat {
            text-align: center;
        }

        .comparison-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .comparison-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Insights Panel */
        .insights-panel {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-elevated));
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .insights-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .insights-title::before {
            content: '!';
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--accent-highlight);
            color: var(--bg-primary);
            font-weight: 700;
            font-size: 0.875rem;
            border-radius: 6px;
        }

        .insights-list {
            display: grid;
            gap: 0.75rem;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .insight-badge {
            flex-shrink: 0;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .insight-badge.critical {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-negative);
        }

        .insight-badge.warning {
            background: rgba(251, 191, 36, 0.2);
            color: var(--gold);
        }

        .insight-badge.info {
            background: rgba(99, 102, 241, 0.2);
            color: var(--accent-neutral);
        }

        /* Footer */
        .footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .footer a {
            color: var(--accent-neutral);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .metric-card, .chart-card, .comparison-card, .insights-panel {
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .metric-card:nth-child(1) { animation-delay: 0.1s; }
        .metric-card:nth-child(2) { animation-delay: 0.15s; }
        .metric-card:nth-child(3) { animation-delay: 0.2s; }
        .metric-card:nth-child(4) { animation-delay: 0.25s; }
        .metric-card:nth-child(5) { animation-delay: 0.3s; }

        .chart-card:nth-child(1) { animation-delay: 0.35s; }
        .chart-card:nth-child(2) { animation-delay: 0.4s; }

        .comparison-card:nth-child(1) { animation-delay: 0.45s; }
        .comparison-card:nth-child(2) { animation-delay: 0.5s; }

        .insights-panel { animation-delay: 0.55s; }

        /* Filter Toggle */
        .filter-toggle-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding: 1rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
        }

        .filter-toggle {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 26px;
            flex-shrink: 0;
        }

        .filter-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-elevated);
            border: 1px solid var(--border-color);
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-muted);
            transition: 0.3s;
            border-radius: 50%;
        }

        .filter-toggle input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--accent-highlight), var(--accent-neutral));
            border-color: var(--accent-highlight);
        }

        .filter-toggle input:checked + .toggle-slider:before {
            transform: translateX(22px);
            background-color: white;
        }

        .filter-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .filter-hint {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .filter-active-badge {
            display: none;
            padding: 0.25rem 0.5rem;
            background: rgba(244, 114, 182, 0.2);
            color: var(--accent-highlight);
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: auto;
        }

        .filter-toggle-container.active .filter-active-badge {
            display: block;
        }

        .filters-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .filters-row .filter-toggle-container {
            margin-bottom: 0;
        }

        .filter-select-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
        }

        .filter-select {
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.875rem;
            cursor: pointer;
            min-width: 160px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-neutral);
        }

        .filter-select option {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .limited-data-warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--gold);
        }

        .limited-data-warning.visible {
            display: flex;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .nav-tab {
            padding: 0.6rem 1.2rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .nav-tab:hover {
            border-color: var(--accent-neutral);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent-highlight), var(--accent-neutral));
            border-color: transparent;
            color: white;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div>
                    <h1>Prediction Accuracy Analysis</h1>
                    <p style="color: var(--text-secondary); margin-top: 0.25rem;">TPV Career Mode - Season 1</p>
                </div>
                <div class="header-meta">
                    <span><span class="status-dot"></span> Live Data</span>
                    <span id="header-results">120 Human Results</span>
                    <span>128 Races</span>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <a href="prediction-dashboard.html" class="nav-tab active">Prediction Accuracy</a>
            <a href="matchmaking-dashboard.html" class="nav-tab">Matchmaking Effectiveness</a>
        </nav>

        <!-- Filters -->
        <div class="filters-row">
            <div class="filter-toggle-container">
                <label class="filter-toggle">
                    <input type="checkbox" id="excludeDiamond">
                    <span class="toggle-slider"></span>
                </label>
                <span class="filter-label">Exclude Diamond riders</span>
                <span class="filter-hint">(7 results with 100% accuracy)</span>
            </div>

            <div class="filter-select-container">
                <span class="filter-label">Time Trials:</span>
                <select id="ttFilter" class="filter-select">
                    <option value="all">All races</option>
                    <option value="ttOnly">TT only (4 results)</option>
                    <option value="excludeTT">Exclude TT (116 results)</option>
                </select>
            </div>
        </div>

        <!-- Limited Data Warning -->
        <div class="limited-data-warning" id="limitedDataWarning">
            <span>&#x26A0;</span>
            <span><strong>Limited data:</strong> Only 4 TT results available. Statistics may not be meaningful.</span>
        </div>

        <!-- Key Metrics (Human Riders Only) -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Mean Absolute Error</div>
                <div class="metric-value highlight" id="metric-mae">9.70</div>
                <div class="metric-subtext">positions off on average</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Exact Predictions</div>
                <div class="metric-value" id="metric-exact">12.5%</div>
                <div class="metric-subtext" id="metric-exact-sub">15 of 120 results</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Within 3 Positions</div>
                <div class="metric-value positive" id="metric-within3">32.5%</div>
                <div class="metric-subtext" id="metric-within3-sub">39 results</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Within 5 Positions</div>
                <div class="metric-value positive" id="metric-within5">45.0%</div>
                <div class="metric-subtext" id="metric-within5-sub">54 results</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Prediction Bias</div>
                <div class="metric-value" style="color: var(--accent-positive);" id="metric-bias">-1.67</div>
                <div class="metric-subtext">humans beat predictions</div>
            </div>
        </div>

        <!-- Distribution Chart -->
        <div class="section-header">
            <h2>Error Distribution</h2>
        </div>

        <div class="chart-card full-width">
            <div class="chart-title">Prediction Error Distribution</div>
            <div class="chart-subtitle">Negative = finished better than predicted | Positive = finished worse than predicted | Grouped in buckets of 2 positions</div>
            <div class="chart-container tall">
                <canvas id="distributionChart"></canvas>
            </div>
        </div>

        <!-- ARR Band Analysis -->
        <div class="section-header">
            <h2>Accuracy by ARR Band</h2>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <div class="chart-title">Mean Absolute Error by Band</div>
                <div class="chart-subtitle">Lower is better - shows prediction accuracy per skill tier</div>
                <div class="chart-container">
                    <canvas id="maeChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-title">Within 3 Positions Rate</div>
                <div class="chart-subtitle">Percentage of predictions within 3 positions of actual</div>
                <div class="chart-container">
                    <canvas id="within3Chart"></canvas>
                </div>
            </div>
        </div>

        <!-- ARR Band Table (Human Riders Only) -->
        <div class="chart-card full-width">
            <div class="chart-title">Detailed ARR Band Breakdown</div>
            <div class="chart-subtitle">Human rider statistics for each skill tier</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ARR Band</th>
                        <th>Results</th>
                        <th>MAE</th>
                        <th>Within 3</th>
                        <th>Avg Diff</th>
                        <th>Trend</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="band-indicator"><span class="band-dot diamond"></span>Diamond</span></td>
                        <td>7</td>
                        <td style="color: var(--accent-positive);">0.00</td>
                        <td style="color: var(--accent-positive);">100.0%</td>
                        <td class="trend-neutral">0.00</td>
                        <td class="trend-positive">Perfect predictions</td>
                    </tr>
                    <tr>
                        <td><span class="band-indicator"><span class="band-dot platinum"></span>Platinum</span></td>
                        <td>27</td>
                        <td>8.67</td>
                        <td>37.0%</td>
                        <td class="trend-negative">+1.11</td>
                        <td class="trend-negative">Finish slightly worse</td>
                    </tr>
                    <tr>
                        <td><span class="band-indicator"><span class="band-dot gold"></span>Gold</span></td>
                        <td>39</td>
                        <td>8.67</td>
                        <td>35.9%</td>
                        <td class="trend-negative">+1.49</td>
                        <td class="trend-negative">Finish slightly worse</td>
                    </tr>
                    <tr>
                        <td><span class="band-indicator"><span class="band-dot silver"></span>Silver</span></td>
                        <td>5</td>
                        <td>6.00</td>
                        <td>20.0%</td>
                        <td class="trend-positive">-0.40</td>
                        <td class="trend-neutral">Limited sample size</td>
                    </tr>
                    <tr>
                        <td><span class="band-indicator"><span class="band-dot bronze"></span>Bronze</span></td>
                        <td>17</td>
                        <td>9.47</td>
                        <td>23.5%</td>
                        <td class="trend-positive">-5.59</td>
                        <td class="trend-positive">Beat predictions significantly</td>
                    </tr>
                    <tr>
                        <td><span class="band-indicator"><span class="band-dot" style="background: #6b7280;"></span>Unranked</span></td>
                        <td>25</td>
                        <td style="color: var(--accent-negative);">16.04</td>
                        <td style="color: var(--accent-negative);">12.0%</td>
                        <td class="trend-positive">-7.64</td>
                        <td class="trend-positive">Beat predictions but high variance</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Human vs Bot Comparison -->
        <div class="section-header">
            <h2>Human vs Bot Comparison</h2>
        </div>

        <div class="comparison-grid">
            <div class="comparison-card">
                <div class="comparison-header">
                    <div class="comparison-icon human">&#x1F464;</div>
                    <div>
                        <div class="comparison-title">Human Riders</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">120 results</div>
                    </div>
                </div>
                <div class="comparison-stats">
                    <div class="comparison-stat">
                        <div class="comparison-stat-value" style="color: var(--accent-negative);">9.70</div>
                        <div class="comparison-stat-label">MAE</div>
                    </div>
                    <div class="comparison-stat">
                        <div class="comparison-stat-value" style="color: var(--accent-positive);">12.5%</div>
                        <div class="comparison-stat-label">Exact</div>
                    </div>
                    <div class="comparison-stat">
                        <div class="comparison-stat-value" style="color: var(--accent-positive);">-1.67</div>
                        <div class="comparison-stat-label">Avg Diff</div>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); font-size: 0.8rem; color: var(--text-secondary);">
                    Humans beat predictions more often but are less predictable overall
                </div>
            </div>

            <div class="comparison-card">
                <div class="comparison-header">
                    <div class="comparison-icon bot">&#x1F916;</div>
                    <div>
                        <div class="comparison-title">Bot Riders</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">4,590 results</div>
                    </div>
                </div>
                <div class="comparison-stats">
                    <div class="comparison-stat">
                        <div class="comparison-stat-value" style="color: var(--accent-positive);">8.38</div>
                        <div class="comparison-stat-label">MAE</div>
                    </div>
                    <div class="comparison-stat">
                        <div class="comparison-stat-value">5.5%</div>
                        <div class="comparison-stat-label">Exact</div>
                    </div>
                    <div class="comparison-stat">
                        <div class="comparison-stat-value" style="color: var(--text-secondary);">+0.04</div>
                        <div class="comparison-stat-label">Avg Diff</div>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); font-size: 0.8rem; color: var(--text-secondary);">
                    Bots are more predictable with nearly balanced performance
                </div>
            </div>
        </div>

        <!-- Key Insights -->
        <div class="insights-panel">
            <div class="insights-title">Key Findings for Developers</div>
            <div class="insights-list">
                <div class="insight-item">
                    <span class="insight-badge critical">Critical</span>
                    <span><strong>Unranked riders have worst accuracy</strong> (MAE 16.04) - new riders without established ratings are highly unpredictable. Consider special handling for unranked players.</span>
                </div>
                <div class="insight-item">
                    <span class="insight-badge warning">Warning</span>
                    <span><strong>Humans consistently beat predictions:</strong> Average diff of -1.67 means humans finish ~2 positions better than predicted. The model underestimates human performance.</span>
                </div>
                <div class="insight-item">
                    <span class="insight-badge info">Pattern</span>
                    <span><strong>Bronze riders massively outperform</strong> predictions (-5.59 avg diff). Lower-rated humans beat predictions by ~6 positions on average.</span>
                </div>
                <div class="insight-item">
                    <span class="insight-badge info">Pattern</span>
                    <span><strong>Diamond predictions are perfect:</strong> All 7 Diamond-tier results matched predictions exactly. High consistency at the top tier.</span>
                </div>
                <div class="insight-item">
                    <span class="insight-badge warning">Warning</span>
                    <span><strong>Humans less predictable than bots:</strong> Human MAE 9.70 vs Bot MAE 8.38. Consider separate prediction models or wider confidence intervals for humans.</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div>Generated from 128 race files | <a href="prediction_accuracy_data.csv">Download CSV Data</a> | <a href="PREDICTION_ACCURACY_REPORT.txt">Full Report</a></div>
            <div>TPV Career Mode Prediction Analysis</div>
        </footer>
    </div>

    <script>
        // ============================================
        // DATA SETS: With and Without Diamond Riders
        // ============================================

        // Distribution labels (buckets of 2, with 0 as its own bucket)
        const distributionLabels = [
            '-21 or less', '-20 to -19', '-18 to -17', '-16 to -15', '-14 to -13',
            '-12 to -11', '-10 to -9', '-8 to -7', '-6 to -5', '-4 to -3', '-2 to -1',
            '0 (exact)',
            '+1 to +2', '+3 to +4', '+5 to +6', '+7 to +8', '+9 to +10',
            '+11 to +12', '+13 to +14', '+15 to +16', '+17 to +18', '+19 to +20', '+21 or more'
        ];

        // Data for all filter combinations
        // Key format: {ttFilter}_{diamond} where diamond is 'with' or 'without'
        const allData = {
            // ALL RACES
            'all_with': {
                count: 120,
                mae: 9.70,
                exact: 15, exactPct: 12.5,
                within3: 39, within3Pct: 32.5,
                within5: 54, within5Pct: 45.0,
                bias: -1.67,
                distribution: [10, 3, 0, 4, 1, 7, 7, 6, 5, 13, 12, 15, 5, 3, 4, 2, 3, 2, 2, 3, 1, 2, 10],
                bandLabels: ['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze', 'Unranked'],
                bandMAE: [0.00, 8.67, 8.67, 6.00, 9.47, 16.04],
                bandWithin3: [100, 37.0, 35.9, 20.0, 23.5, 12.0],
                bandColors: ['rgba(34, 211, 238, 0.7)', 'rgba(161, 161, 170, 0.7)', 'rgba(251, 191, 36, 0.7)', 'rgba(156, 163, 175, 0.7)', 'rgba(217, 119, 6, 0.7)', 'rgba(107, 114, 128, 0.7)'],
                bandBorders: ['#22d3ee', '#a1a1aa', '#fbbf24', '#9ca3af', '#d97706', '#6b7280']
            },
            'all_without': {
                count: 113,
                mae: 10.30,
                exact: 8, exactPct: 7.1,
                within3: 32, within3Pct: 28.3,
                within5: 47, within5Pct: 41.6,
                bias: -1.77,
                distribution: [10, 3, 0, 4, 1, 7, 7, 6, 5, 13, 12, 8, 5, 3, 4, 2, 3, 2, 2, 3, 1, 2, 10],
                bandLabels: ['Platinum', 'Gold', 'Silver', 'Bronze', 'Unranked'],
                bandMAE: [8.67, 8.67, 6.00, 9.47, 16.04],
                bandWithin3: [37.0, 35.9, 20.0, 23.5, 12.0],
                bandColors: ['rgba(161, 161, 170, 0.7)', 'rgba(251, 191, 36, 0.7)', 'rgba(156, 163, 175, 0.7)', 'rgba(217, 119, 6, 0.7)', 'rgba(107, 114, 128, 0.7)'],
                bandBorders: ['#a1a1aa', '#fbbf24', '#9ca3af', '#d97706', '#6b7280']
            },
            // TT ONLY (4 results - very limited!)
            'ttOnly_with': {
                count: 4,
                mae: 17.00,
                exact: 0, exactPct: 0,
                within3: 0, within3Pct: 0,
                within5: 0, within5Pct: 0,
                bias: 11.00,
                distribution: [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1],
                bandLabels: ['Gold', 'Unranked'],
                bandMAE: [24.50, 9.50],
                bandWithin3: [0, 0],
                bandColors: ['rgba(251, 191, 36, 0.7)', 'rgba(107, 114, 128, 0.7)'],
                bandBorders: ['#fbbf24', '#6b7280']
            },
            'ttOnly_without': {
                count: 4,
                mae: 17.00,
                exact: 0, exactPct: 0,
                within3: 0, within3Pct: 0,
                within5: 0, within5Pct: 0,
                bias: 11.00,
                distribution: [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1],
                bandLabels: ['Gold', 'Unranked'],
                bandMAE: [24.50, 9.50],
                bandWithin3: [0, 0],
                bandColors: ['rgba(251, 191, 36, 0.7)', 'rgba(107, 114, 128, 0.7)'],
                bandBorders: ['#fbbf24', '#6b7280']
            },
            // EXCLUDE TT (116 results)
            'excludeTT_with': {
                count: 116,
                mae: 9.45,
                exact: 15, exactPct: 12.9,
                within3: 39, within3Pct: 33.6,
                within5: 54, within5Pct: 46.6,
                bias: -2.10,
                distribution: [10, 3, 0, 4, 1, 7, 7, 6, 5, 13, 12, 15, 5, 3, 4, 1, 3, 2, 2, 3, 0, 1, 9],
                bandLabels: ['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze', 'Unranked'],
                bandMAE: [0.00, 8.67, 6.84, 6.00, 9.47, 16.61],
                bandWithin3: [100, 37.0, 37.8, 20.0, 23.5, 13.0],
                bandColors: ['rgba(34, 211, 238, 0.7)', 'rgba(161, 161, 170, 0.7)', 'rgba(251, 191, 36, 0.7)', 'rgba(156, 163, 175, 0.7)', 'rgba(217, 119, 6, 0.7)', 'rgba(107, 114, 128, 0.7)'],
                bandBorders: ['#22d3ee', '#a1a1aa', '#fbbf24', '#9ca3af', '#d97706', '#6b7280']
            },
            'excludeTT_without': {
                count: 109,
                mae: 10.06,
                exact: 8, exactPct: 7.3,
                within3: 32, within3Pct: 29.4,
                within5: 47, within5Pct: 43.1,
                bias: -2.24,
                distribution: [10, 3, 0, 4, 1, 7, 7, 6, 5, 13, 12, 8, 5, 3, 4, 1, 3, 2, 2, 3, 0, 1, 9],
                bandLabels: ['Platinum', 'Gold', 'Silver', 'Bronze', 'Unranked'],
                bandMAE: [8.67, 6.84, 6.00, 9.47, 16.61],
                bandWithin3: [37.0, 37.8, 20.0, 23.5, 13.0],
                bandColors: ['rgba(161, 161, 170, 0.7)', 'rgba(251, 191, 36, 0.7)', 'rgba(156, 163, 175, 0.7)', 'rgba(217, 119, 6, 0.7)', 'rgba(107, 114, 128, 0.7)'],
                bandBorders: ['#a1a1aa', '#fbbf24', '#9ca3af', '#d97706', '#6b7280']
            }
        };

        // Chart instances (for updating)
        let distributionChart, maeChart, within3Chart;

        // Current filter state
        let excludeDiamond = false;
        let ttFilter = 'all'; // 'all', 'ttOnly', 'excludeTT'

        // ============================================
        // UPDATE FUNCTIONS
        // ============================================

        function getCurrentData() {
            const diamondKey = excludeDiamond ? 'without' : 'with';
            const key = `${ttFilter}_${diamondKey}`;
            return allData[key];
        }

        function updateMetrics() {
            const data = getCurrentData();

            document.getElementById('header-results').textContent = `${data.count} Human Results`;
            document.getElementById('metric-mae').textContent = data.mae.toFixed(2);
            document.getElementById('metric-exact').textContent = data.exactPct.toFixed(1) + '%';
            document.getElementById('metric-exact-sub').textContent = `${data.exact} of ${data.count} results`;
            document.getElementById('metric-within3').textContent = data.within3Pct.toFixed(1) + '%';
            document.getElementById('metric-within3-sub').textContent = `${data.within3} results`;
            document.getElementById('metric-within5').textContent = data.within5Pct.toFixed(1) + '%';
            document.getElementById('metric-within5-sub').textContent = `${data.within5} results`;
            document.getElementById('metric-bias').textContent = data.bias.toFixed(2);

            // Update bias color based on value
            const biasEl = document.getElementById('metric-bias');
            if (data.bias < 0) {
                biasEl.style.color = 'var(--accent-positive)';
            } else if (data.bias > 0) {
                biasEl.style.color = 'var(--accent-negative)';
            } else {
                biasEl.style.color = 'var(--text-secondary)';
            }

            // Show/hide limited data warning
            const warning = document.getElementById('limitedDataWarning');
            warning.classList.toggle('visible', ttFilter === 'ttOnly');
        }

        function updateCharts() {
            const data = getCurrentData();

            // Update distribution chart
            distributionChart.data.datasets[0].data = data.distribution;
            distributionChart.update();

            // Update MAE chart
            maeChart.data.labels = data.bandLabels;
            maeChart.data.datasets[0].data = data.bandMAE;
            maeChart.data.datasets[0].backgroundColor = data.bandColors;
            maeChart.data.datasets[0].borderColor = data.bandBorders;
            maeChart.update();

            // Update Within 3 chart
            within3Chart.data.labels = data.bandLabels;
            within3Chart.data.datasets[0].data = data.bandWithin3;
            within3Chart.data.datasets[0].backgroundColor = data.bandColors;
            within3Chart.data.datasets[0].borderColor = data.bandBorders;
            within3Chart.update();
        }

        function updateAll() {
            updateMetrics();
            updateCharts();
        }

        // Diamond toggle handler
        document.getElementById('excludeDiamond').addEventListener('change', function() {
            excludeDiamond = this.checked;
            document.querySelector('.filter-toggle-container').classList.toggle('active', excludeDiamond);
            updateAll();
        });

        // TT filter handler
        document.getElementById('ttFilter').addEventListener('change', function() {
            ttFilter = this.value;
            updateAll();
        });

        // ============================================
        // CHART INITIALIZATION
        // ============================================

        // Chart.js global defaults
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = '#2d3a52';
        Chart.defaults.font.family = "'Outfit', sans-serif";

        // Distribution Chart (Human Riders Only) - buckets of 2, range -20 to +21+
        const distributionCtx = document.getElementById('distributionChart').getContext('2d');
        const distributionData = {
            labels: distributionLabels,
            datasets: [{
                label: 'Count',
                data: allData['all_with'].distribution,
                backgroundColor: function(context) {
                    const index = context.dataIndex;
                    // Index 11 is "0 (exact)"
                    if (index < 11) return 'rgba(16, 185, 129, 0.7)'; // Better than predicted - green
                    if (index === 11) return 'rgba(99, 102, 241, 0.9)'; // Exact - purple
                    return 'rgba(239, 68, 68, 0.7)'; // Worse than predicted - red
                },
                borderColor: function(context) {
                    const index = context.dataIndex;
                    if (index < 11) return '#10b981';
                    if (index === 11) return '#6366f1';
                    return '#ef4444';
                },
                borderWidth: 1,
                borderRadius: 4,
            }]
        };

        distributionChart = new Chart(distributionCtx, {
            type: 'bar',
            data: distributionData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1a2234',
                        borderColor: '#2d3a52',
                        borderWidth: 1,
                        titleFont: { family: "'JetBrains Mono', monospace" },
                        bodyFont: { family: "'JetBrains Mono', monospace" },
                        callbacks: {
                            title: function(items) {
                                const idx = items[0].dataIndex;
                                if (idx < 10) return `${items[0].label} positions (beat prediction)`;
                                if (idx === 10) return 'Exact prediction';
                                return `+${idx - 10} positions (missed prediction)`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: '#2d3a52' },
                        ticks: { font: { family: "'JetBrains Mono', monospace", size: 10 } }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: { family: "'JetBrains Mono', monospace", size: 9 },
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });

        // MAE by Band Chart (Human Riders Only)
        const maeCtx = document.getElementById('maeChart').getContext('2d');
        maeChart = new Chart(maeCtx, {
            type: 'bar',
            data: {
                labels: ['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze', 'Unranked'],
                datasets: [{
                    label: 'MAE',
                    data: [0.00, 8.67, 8.67, 6.00, 9.47, 16.04],
                    backgroundColor: [
                        'rgba(34, 211, 238, 0.7)',
                        'rgba(161, 161, 170, 0.7)',
                        'rgba(251, 191, 36, 0.7)',
                        'rgba(156, 163, 175, 0.7)',
                        'rgba(217, 119, 6, 0.7)',
                        'rgba(107, 114, 128, 0.7)'
                    ],
                    borderColor: ['#22d3ee', '#a1a1aa', '#fbbf24', '#9ca3af', '#d97706', '#6b7280'],
                    borderWidth: 2,
                    borderRadius: 6,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1a2234',
                        borderColor: '#2d3a52',
                        borderWidth: 1,
                        callbacks: {
                            label: function(context) {
                                return `MAE: ${context.raw.toFixed(2)} positions`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 18,
                        grid: { color: '#2d3a52' },
                        ticks: { font: { family: "'JetBrains Mono', monospace" } }
                    },
                    y: {
                        grid: { display: false },
                        ticks: { font: { weight: 500 } }
                    }
                }
            }
        });

        // Within 3 Chart (Human Riders Only)
        const within3Ctx = document.getElementById('within3Chart').getContext('2d');
        within3Chart = new Chart(within3Ctx, {
            type: 'bar',
            data: {
                labels: ['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze', 'Unranked'],
                datasets: [{
                    label: 'Within 3',
                    data: [100, 37.0, 35.9, 20.0, 23.5, 12.0],
                    backgroundColor: [
                        'rgba(34, 211, 238, 0.7)',
                        'rgba(161, 161, 170, 0.7)',
                        'rgba(251, 191, 36, 0.7)',
                        'rgba(156, 163, 175, 0.7)',
                        'rgba(217, 119, 6, 0.7)',
                        'rgba(107, 114, 128, 0.7)'
                    ],
                    borderColor: ['#22d3ee', '#a1a1aa', '#fbbf24', '#9ca3af', '#d97706', '#6b7280'],
                    borderWidth: 2,
                    borderRadius: 6,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1a2234',
                        borderColor: '#2d3a52',
                        borderWidth: 1,
                        callbacks: {
                            label: function(context) {
                                return `Within 3: ${context.raw.toFixed(1)}%`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: '#2d3a52' },
                        ticks: {
                            font: { family: "'JetBrains Mono', monospace" },
                            callback: function(value) { return value + '%'; }
                        }
                    },
                    y: {
                        grid: { display: false },
                        ticks: { font: { weight: 500 } }
                    }
                }
            }
        });

    </script>
</body>
</html>
